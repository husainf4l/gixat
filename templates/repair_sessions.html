{% extends 'base.html' %}
{% load static %}

{% block title %}Repair Sessions - Gixat Auto Workshop{% endblock %}

{% block navbar %}{% endblock %}

{% block content %}
<div class="flex h-screen bg-gray-50">
    <!-- Sidebar -->
    <div class="w-64 bg-white shadow-lg">
        <div class="p-6">
            <div class="flex items-center">
                <img src="{% static 'images/gixat-logo.png' %}" alt="Gixat Logo" class="h-8 w-auto mr-3">
                <span class="text-xl font-bold text-gray-800">Gixat</span>
            </div>
        </div>
        <nav class="mt-6">
            <a href="{% url 'dashboard' %}" class="flex items-center px-6 py-3 text-gray-700 hover:bg-gray-200 hover:text-gray-900 transition duration-200">
                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z"></path>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5a2 2 0 012-2h4a2 2 0 012 2v2H8V5z"></path>
                </svg>
                Dashboard
            </a>
            <a href="#" class="flex items-center px-6 py-3 bg-blue-100 text-blue-900 border-r-4 border-blue-500">
                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                </svg>
                Repair Sessions
            </a>
            <a href="{% url 'inventory' %}" class="flex items-center px-6 py-3 text-gray-700 hover:bg-gray-200 hover:text-gray-900 transition duration-200">
                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path>
                </svg>
                Inventory
            </a>
            <a href="{% url 'services' %}" class="flex items-center px-6 py-3 text-gray-700 hover:bg-gray-200 hover:text-gray-900 transition duration-200">
                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                </svg>
                Services
            </a>
            <a href="{% url 'reports' %}" class="flex items-center px-6 py-3 text-gray-700 hover:bg-gray-200 hover:text-gray-900 transition duration-200">
                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                </svg>
                Reports
            </a>
        </nav>
    </div>

    <!-- Main Content -->
    <div class="flex-1 flex flex-col overflow-hidden">
        <!-- Top Bar -->
        <header class="bg-white shadow-sm border-b border-gray-200 px-6 py-4">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-2xl font-semibold text-gray-800">Repair Sessions</h1>
                    <p class="text-sm text-gray-600">Manage and track all repair sessions ({{ total_sessions }} total)</p>
                </div>
                <div class="flex items-center space-x-4">
                    <a href="{% url 'new_session' %}" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition duration-200 flex items-center">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                        </svg>
                        New Session
                    </a>
                    <div class="flex items-center space-x-2">
                        <span class="text-sm text-gray-600">Welcome, Admin</span>
                        <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center">
                            <span class="text-white text-sm font-medium">A</span>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Content Area -->
        <main class="flex-1 overflow-x-hidden overflow-y-auto bg-gray-50 p-6">
            <!-- Messages -->
            {% if messages %}
                {% for message in messages %}
                    <div class="mb-4 px-4 py-3 rounded-lg {% if message.tags == 'success' %}bg-green-50 border border-green-200 text-green-800{% elif message.tags == 'error' %}bg-red-50 border border-red-200 text-red-800{% elif message.tags == 'warning' %}bg-yellow-50 border border-yellow-200 text-yellow-800{% else %}bg-blue-50 border border-blue-200 text-blue-800{% endif %}">
                        <div class="flex items-center">
                            {% if message.tags == 'success' %}
                                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            {% elif message.tags == 'error' %}
                                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            {% elif message.tags == 'warning' %}
                                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.854-.833-2.5 0L3.232 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                                </svg>
                            {% else %}
                                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            {% endif %}
                            {{ message }}
                        </div>
                    </div>
                {% endfor %}
            {% endif %}

            <!-- Filters and Search -->
            <div class="bg-white rounded-lg shadow mb-6 p-4">
                <div class="flex flex-col md:flex-row md:items-center md:justify-between space-y-4 md:space-y-0">
                    <div class="flex flex-col md:flex-row md:items-center space-y-2 md:space-y-0 md:space-x-4">
                        <div class="relative">
                            <input type="text" placeholder="Search sessions..." class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent w-full md:w-64">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <svg class="h-5 w-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd"></path>
                                </svg>
                            </div>
                        </div>
                        <select class="px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option>All Status</option>
                            <option>Scheduled</option>
                            <option>In Progress</option>
                            <option>Completed</option>
                            <option>On Hold</option>
                        </select>
                        <select class="px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option>All Mechanics</option>
                            <option>John Smith</option>
                            <option>Sarah Johnson</option>
                            <option>Mike Davis</option>
                        </select>
                    </div>
                    <div class="flex items-center space-x-2">
                        <button class="px-3 py-2 text-gray-600 hover:text-gray-800 transition duration-200">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4"></path>
                            </svg>
                        </button>
                        <button class="px-3 py-2 text-gray-600 hover:text-gray-800 transition duration-200">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Sessions Grid -->
                        <!-- Sessions Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                {% for session in sessions %}
                <!-- Session Card -->
                <div class="bg-white rounded-lg shadow hover:shadow-lg transition duration-200">
                    <div class="p-6">
                        <!-- Header -->
                        <div class="flex items-center justify-between mb-4">
                            <div>
                                <h3 class="text-lg font-semibold text-gray-800">{{ session.session_number }}</h3>
                                <p class="text-sm text-gray-600">{{ session.car.make }} {{ session.car.model }} {{ session.car.year }}</p>
                            </div>
                            <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full
                                {% if session.status == 'scheduled' %}bg-yellow-100 text-yellow-800
                                {% elif session.status == 'in_progress' %}bg-blue-100 text-blue-800
                                {% elif session.status == 'completed' %}bg-green-100 text-green-800
                                {% else %}bg-gray-100 text-gray-800{% endif %}">
                                {{ session.get_status_display }}
                            </span>
                        </div>

                        <!-- Client Info -->
                        <div class="mb-4">
                            <div class="flex items-center">
                                <svg class="w-4 h-4 text-gray-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                </svg>
                                <span class="text-sm text-gray-600">{{ session.car.client.full_name }} - {{ session.car.client.phone }}</span>
                            </div>
                        </div>

                        <!-- Job Type & Mechanic -->
                        <div class="mb-4">
                            <div class="flex items-center justify-between">
                                <span class="text-sm font-medium text-gray-700">{{ session.description|truncatechars:25|default:"General Service" }}</span>
                                <span class="text-sm text-gray-600">{{ session.technician.user.get_full_name }}</span>
                            </div>
                        </div>

                        <!-- Timeline -->
                        <div class="mb-4">
                            <div class="flex items-center justify-between text-xs text-gray-600 mb-2">
                                <span>Scheduled: {{ session.scheduled_date|date:"M d, g:i A" }}</span>
                                {% if session.actual_end_time %}
                                <span>Completed: {{ session.actual_end_time|date:"M d, g:i A" }}</span>
                                {% else %}
                                <span>Est. End: {{ session.scheduled_date|date:"M d, g:i A" }}</span>
                                {% endif %}
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                {% if session.status == 'completed' %}
                                    <div class="h-2 rounded-full bg-green-600" style="width: 100%"></div>
                                {% elif session.status == 'in_progress' %}
                                    <div class="h-2 rounded-full bg-blue-600" style="width: 60%"></div>
                                {% else %}
                                    <div class="h-2 rounded-full bg-gray-400" style="width: 20%"></div>
                                {% endif %}
                            </div>
                            <div class="flex justify-between text-xs text-gray-500 mt-1">
                                <span>Check-in</span>
                                <span>Diagnosis</span>
                                <span>Repair</span>
                                <span>Complete</span>
                            </div>
                        </div>

                        <!-- Quick Actions -->
                        <div class="flex space-x-2">
                            <a href="{% url 'view_session' session.id %}" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded text-sm text-center transition duration-200">
                                View Details
                            </a>
                            {% if session.status == 'scheduled' %}
                            <a href="{% url 'start_session' session.id %}" class="flex-1 bg-green-600 hover:bg-green-700 text-white px-3 py-2 rounded text-sm text-center transition duration-200">
                                Start Session
                            </a>
                            {% elif session.status == 'in_progress' %}
                            <div class="flex space-x-1 flex-1">
                                <a href="{% url 'update_session_status' session.id %}" class="flex-1 bg-yellow-600 hover:bg-yellow-700 text-white px-2 py-2 rounded text-xs text-center transition duration-200">
                                    Update
                                </a>
                                <a href="{% url 'complete_session' session.id %}" class="flex-1 bg-purple-600 hover:bg-purple-700 text-white px-2 py-2 rounded text-xs text-center transition duration-200">
                                    Complete
                                </a>
                            </div>
                            {% elif session.status == 'completed' %}
                            <a href="{% url 'generate_invoice' session.id %}" class="flex-1 bg-indigo-600 hover:bg-indigo-700 text-white px-3 py-2 rounded text-sm text-center transition duration-200">
                                Invoice
                            </a>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% empty %}
                <div class="col-span-full text-center py-12">
                    <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                    </svg>
                    <h3 class="mt-2 text-sm font-medium text-gray-900">No repair sessions</h3>
                    <p class="mt-1 text-sm text-gray-500">Get started by creating a new repair session.</p>
                    <div class="mt-6">
                        <a href="{% url 'new_session' %}" class="inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700">
                            <svg class="-ml-1 mr-2 h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                            </svg>
                            New Session
                        </a>
                    </div>
                </div>
                {% endfor %}
            </div>

            <!-- Detailed Session View (Modal/Expanded) -->
            <div class="bg-white rounded-lg shadow hidden" id="session-detail-modal">
                <div class="p-6">
                    <!-- Session Header -->
                    <div class="flex items-center justify-between mb-6">
                        <div>
                            <h2 class="text-2xl font-bold text-gray-800">Session #RS-2024-001</h2>
                            <p class="text-gray-600">Toyota Camry 2019 - Engine Repair</p>
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="inline-flex px-3 py-1 text-sm font-semibold rounded-full bg-yellow-100 text-yellow-800">
                                In Progress
                            </span>
                            <button class="text-gray-400 hover:text-gray-600" onclick="closeSessionDetail()">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </button>
                        </div>
                    </div>

                    <!-- Session Overview -->
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                        <!-- Client & Vehicle Info -->
                        <div class="bg-gray-50 rounded-lg p-4">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">Client & Vehicle</h3>
                            <div class="space-y-3">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Client</label>
                                    <p class="text-sm text-gray-900">John Smith</p>
                                    <p class="text-sm text-gray-600">(555) 123-4567</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Vehicle</label>
                                    <p class="text-sm text-gray-900">Toyota Camry 2019</p>
                                    <p class="text-sm text-gray-600">License: ABC-1234</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Assigned Mechanic</label>
                                    <p class="text-sm text-gray-900">Mike Johnson</p>
                                </div>
                            </div>
                        </div>

                        <!-- Repair Timeline -->
                        <div class="bg-gray-50 rounded-lg p-4">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">Repair Timeline</h3>
                            <div class="space-y-3">
                                <div class="flex items-center">
                                    <div class="w-3 h-3 bg-green-500 rounded-full mr-3"></div>
                                    <div>
                                        <p class="text-sm font-medium text-gray-900">Check-in</p>
                                        <p class="text-xs text-gray-600">Dec 15, 10:00 AM</p>
                                    </div>
                                </div>
                                <div class="flex items-center">
                                    <div class="w-3 h-3 bg-green-500 rounded-full mr-3"></div>
                                    <div>
                                        <p class="text-sm font-medium text-gray-900">Diagnosis</p>
                                        <p class="text-xs text-gray-600">Dec 15, 10:30 AM</p>
                                    </div>
                                </div>
                                <div class="flex items-center">
                                    <div class="w-3 h-3 bg-yellow-500 rounded-full mr-3"></div>
                                    <div>
                                        <p class="text-sm font-medium text-gray-900">Parts Ordered</p>
                                        <p class="text-xs text-gray-600">Dec 15, 11:00 AM</p>
                                    </div>
                                </div>
                                <div class="flex items-center">
                                    <div class="w-3 h-3 bg-gray-400 rounded-full mr-3"></div>
                                    <div>
                                        <p class="text-sm font-medium text-gray-900">Repair Start</p>
                                        <p class="text-xs text-gray-600">Pending</p>
                                    </div>
                                </div>
                                <div class="flex items-center">
                                    <div class="w-3 h-3 bg-gray-400 rounded-full mr-3"></div>
                                    <div>
                                        <p class="text-sm font-medium text-gray-900">Completion</p>
                                        <p class="text-xs text-gray-600">Est: Dec 16, 2:00 PM</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Cost Breakdown -->
                        <div class="bg-gray-50 rounded-lg p-4">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">Cost Breakdown</h3>
                            <div class="space-y-3">
                                <div class="flex justify-between">
                                    <span class="text-sm text-gray-600">Parts</span>
                                    <span class="text-sm font-medium text-gray-900">$245.80</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-sm text-gray-600">Labor (5 hours)</span>
                                    <span class="text-sm font-medium text-gray-900">$375.00</span>
                                </div>
                                <div class="border-t pt-2">
                                    <div class="flex justify-between">
                                        <span class="text-sm font-medium text-gray-900">Total</span>
                                        <span class="text-sm font-bold text-gray-900">$620.80</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Work Performed -->
                    <div class="bg-white border border-gray-200 rounded-lg mb-6">
                        <div class="p-4 border-b border-gray-200">
                            <h3 class="text-lg font-semibold text-gray-800">Work Performed</h3>
                        </div>
                        <div class="p-4">
                            <div class="space-y-4">
                                <div class="flex items-center justify-between p-3 bg-gray-50 rounded">
                                    <div>
                                        <h4 class="font-medium text-gray-900">Engine Diagnostic Scan</h4>
                                        <p class="text-sm text-gray-600">Initial diagnostic to identify engine issues</p>
                                    </div>
                                    <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">
                                        Completed
                                    </span>
                                </div>
                                <div class="flex items-center justify-between p-3 bg-gray-50 rounded">
                                    <div>
                                        <h4 class="font-medium text-gray-900">Oil Filter Replacement</h4>
                                        <p class="text-sm text-gray-600">Replace clogged oil filter</p>
                                    </div>
                                    <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-yellow-100 text-yellow-800">
                                        In Progress
                                    </span>
                                </div>
                                <div class="flex items-center justify-between p-3 bg-gray-50 rounded">
                                    <div>
                                        <h4 class="font-medium text-gray-900">Spark Plug Replacement</h4>
                                        <p class="text-sm text-gray-600">Replace all 4 spark plugs</p>
                                    </div>
                                    <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-gray-100 text-gray-800">
                                        Pending
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Parts & Inventory -->
                    <div class="bg-white border border-gray-200 rounded-lg mb-6">
                        <div class="p-4 border-b border-gray-200">
                            <h3 class="text-lg font-semibold text-gray-800">Parts Used</h3>
                        </div>
                        <div class="p-4">
                            <div class="overflow-x-auto">
                                <table class="min-w-full">
                                    <thead>
                                        <tr class="border-b border-gray-200">
                                            <th class="text-left text-xs font-medium text-gray-500 uppercase tracking-wider py-2">Part</th>
                                            <th class="text-left text-xs font-medium text-gray-500 uppercase tracking-wider py-2">Quantity</th>
                                            <th class="text-left text-xs font-medium text-gray-500 uppercase tracking-wider py-2">Unit Cost</th>
                                            <th class="text-left text-xs font-medium text-gray-500 uppercase tracking-wider py-2">Total</th>
                                            <th class="text-left text-xs font-medium text-gray-500 uppercase tracking-wider py-2">Status</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-gray-200">
                                        <tr>
                                            <td class="py-2 text-sm text-gray-900">Oil Filter (Toyota)</td>
                                            <td class="py-2 text-sm text-gray-900">1</td>
                                            <td class="py-2 text-sm text-gray-900">$12.50</td>
                                            <td class="py-2 text-sm text-gray-900">$12.50</td>
                                            <td class="py-2">
                                                <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">
                                                    In Stock
                                                </span>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="py-2 text-sm text-gray-900">Spark Plugs (Set of 4)</td>
                                            <td class="py-2 text-sm text-gray-900">1</td>
                                            <td class="py-2 text-sm text-gray-900">$45.99</td>
                                            <td class="py-2 text-sm text-gray-900">$45.99</td>
                                            <td class="py-2">
                                                <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-yellow-100 text-yellow-800">
                                                    Ordered
                                                </span>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="py-2 text-sm text-gray-900">Engine Oil (5W-30)</td>
                                            <td class="py-2 text-sm text-gray-900">5</td>
                                            <td class="py-2 text-sm text-gray-900">$8.50</td>
                                            <td class="py-2 text-sm text-gray-900">$42.50</td>
                                            <td class="py-2">
                                                <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">
                                                    In Stock
                                                </span>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Mechanic Notes -->
                    <div class="bg-white border border-gray-200 rounded-lg mb-6">
                        <div class="p-4 border-b border-gray-200">
                            <h3 class="text-lg font-semibold text-gray-800">Mechanic Notes</h3>
                        </div>
                        <div class="p-4">
                            <div class="space-y-4">
                                <div class="bg-blue-50 border-l-4 border-blue-400 p-4">
                                    <div class="flex items-center">
                                        <div class="flex-shrink-0">
                                            <svg class="h-5 w-5 text-blue-400" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                                            </svg>
                                        </div>
                                        <div class="ml-3">
                                            <p class="text-sm text-blue-700">
                                                <strong>Mike Johnson</strong> - Dec 15, 10:30 AM
                                            </p>
                                            <p class="text-sm text-blue-700 mt-1">
                                                Initial diagnostic shows low oil pressure. Oil filter appears clogged. Spark plugs show signs of wear. Recommended replacement of oil filter and spark plugs. Parts ordered and should arrive by noon.
                                            </p>
                                        </div>
                                    </div>
                                </div>
                                <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4">
                                    <div class="flex items-center">
                                        <div class="flex-shrink-0">
                                            <svg class="h-5 w-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                                            </svg>
                                        </div>
                                        <div class="ml-3">
                                            <p class="text-sm text-yellow-700">
                                                <strong>System Alert</strong> - Dec 15, 11:15 AM
                                            </p>
                                            <p class="text-sm text-yellow-700 mt-1">
                                                Spark plugs are on backorder. Expected delivery delayed by 2 hours. Customer notified via SMS.
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Client Communication -->
                    <div class="bg-white border border-gray-200 rounded-lg mb-6">
                        <div class="p-4 border-b border-gray-200">
                            <h3 class="text-lg font-semibold text-gray-800">Client Communication</h3>
                        </div>
                        <div class="p-4">
                            <div class="space-y-4">
                                <div class="flex items-center justify-between p-3 bg-green-50 rounded">
                                    <div>
                                        <p class="text-sm font-medium text-green-900">Approval Request Sent</p>
                                        <p class="text-xs text-green-700">Additional spark plug replacement - $45.99</p>
                                    </div>
                                    <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">
                                        Approved
                                    </span>
                                </div>
                                <div class="flex items-center justify-between p-3 bg-blue-50 rounded">
                                    <div>
                                        <p class="text-sm font-medium text-blue-900">SMS Notification</p>
                                        <p class="text-xs text-blue-700">Parts delay update sent to client</p>
                                    </div>
                                    <span class="text-xs text-blue-600">Dec 15, 11:20 AM</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="flex justify-end space-x-3">
                        <button class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg transition duration-200">
                            Save Changes
                        </button>
                        <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition duration-200">
                            Update Status
                        </button>
                        <button class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition duration-200">
                            Complete Session
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>

<script>
// Toggle session detail modal
function openSessionDetail() {
    document.getElementById('session-detail-modal').classList.remove('hidden');
}

function closeSessionDetail() {
    document.getElementById('session-detail-modal').classList.add('hidden');
}

// Auto-dismiss success messages after 5 seconds
document.addEventListener('DOMContentLoaded', function() {
    const messages = document.querySelectorAll('.bg-green-50, .bg-red-50, .bg-yellow-50, .bg-blue-50');
    messages.forEach(function(message) {
        if (message.textContent.includes('successfully') || message.textContent.includes('created')) {
            setTimeout(function() {
                message.style.transition = 'opacity 0.5s ease';
                message.style.opacity = '0';
                setTimeout(function() {
                    message.remove();
                }, 500);
            }, 5000);
        }
    });
    
    // Refresh indicator when returning from new session page
    if (document.referrer && document.referrer.includes('/new-session/')) {
        const header = document.querySelector('h1');
        if (header) {
            const indicator = document.createElement('span');
            indicator.className = 'inline-block w-2 h-2 bg-green-500 rounded-full ml-2 animate-pulse';
            indicator.title = 'Recently updated';
            header.appendChild(indicator);
            
            setTimeout(() => {
                indicator.remove();
            }, 10000);
        }
    }
});
</script>

{% endblock %}