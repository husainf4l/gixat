@page
@model Gixat.Web.Pages.IndexModel
@{
    ViewData["Title"] = "Gixat - AI-Powered Garage Management";
    Layout = null;
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gixat - AI-Powered Garage Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet" />
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            600: '#2d80c1',
                            700: '#2670ad'
                        }
                    },
                    fontFamily: {
                        sans: ['-apple-system', 'BlinkMacSystemFont', 'SF Pro Display', 'SF Pro Text', 'Helvetica Neue', 'Helvetica', 'Arial', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <style>
        body {
            -webkit-font-smoothing: antialiased;
        }
    </style>
</head>
<body class="bg-slate-50 font-sans overflow-x-hidden">
    <!-- Navigation -->
    <partial name="../Components/_Navbar" />

    <!-- Hero Section -->
    <partial name="../Components/_Hero" />

    <!-- About Section -->
    <partial name="../Components/_About" />

    <!-- Testimonials Section -->
    <partial name="../Components/_Testimonials" />

    <!-- Features Section -->
    <partial name="../Components/_Features" />

    <!-- Pricing Section -->
    <partial name="../Components/_Pricing" />

    <!-- Final CTA Section -->
    <partial name="../Components/_FinalCTA" />

    <!-- Footer Section -->
    <partial name="../Components/_Footer" />

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Smooth Scrolling Script -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const navLinks = document.querySelectorAll('a[href^="#"]');
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    const targetId = this.getAttribute('href');
                    const targetElement = document.querySelector(targetId);
                    if (targetElement) {
                        e.preventDefault();
                        const headerOffset = 80;
                        const elementPosition = targetElement.offsetTop;
                        const offsetPosition = elementPosition - headerOffset;
                        window.scrollTo({ top: offsetPosition, behavior: 'smooth' });
                    }
                });
            });
        });
    </script>

    <!-- GraphQL Client -->
    <script>
        class GraphQLClient {
            constructor(endpoint) { this.endpoint = endpoint; }
            async query(query, variables = {}) {
                const response = await fetch(this.endpoint, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ query, variables })
                });
                if (!response.ok) throw new Error(`GraphQL query failed: ${response.status}`);
                const result = await response.json();
                if (result.errors) throw new Error(`GraphQL errors: ${result.errors.map(e => e.message).join(', ')}`);
                return result.data;
            }
        }

        const client = new GraphQLClient('/graphql');

        document.addEventListener('DOMContentLoaded', async () => {
            await loadLiveStats();
            await loadAboutStats();
            const yearElement = document.getElementById('current-year');
            if (yearElement) yearElement.textContent = new Date().getFullYear();
        });

        async function loadLiveStats() {
            const loadingElement = document.getElementById('statsLoading');
            const statsGrid = document.getElementById('statsGrid');
            if (!loadingElement || !statsGrid) return;

            try {
                loadingElement.style.display = 'flex';
                const data = await client.query(`query { platformStats { totalClients totalCompanies totalRevenue averageRevenuePerClient } }`);
                const stats = data.platformStats;
                loadingElement.style.display = 'none';

                statsGrid.innerHTML = `
                    <div class="bg-gradient-to-br from-blue-50 to-white rounded-2xl p-8 border border-blue-100 hover:shadow-lg transition-all relative overflow-hidden">
                        <div class="absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-blue-600 to-purple-600"></div>
                        <div class="text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-purple-600 mb-2">${stats.totalClients.toLocaleString()}</div>
                        <div class="text-sm text-slate-600 font-medium uppercase tracking-wider mb-4">Total Clients</div>
                        <div class="text-sm text-slate-600">Active customers across all garages</div>
                        <div class="flex items-center gap-2 text-green-600 text-xs font-semibold mt-3"><i class="bi bi-arrow-up"></i> Growing platform</div>
                    </div>
                    <div class="bg-gradient-to-br from-blue-50 to-white rounded-2xl p-8 border border-blue-100 hover:shadow-lg transition-all relative overflow-hidden">
                        <div class="absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-blue-600 to-purple-600"></div>
                        <div class="text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-purple-600 mb-2">${stats.totalCompanies}</div>
                        <div class="text-sm text-slate-600 font-medium uppercase tracking-wider mb-4">Partner Garages</div>
                        <div class="text-sm text-slate-600">Trusted garage partners</div>
                        <div class="flex items-center gap-2 text-green-600 text-xs font-semibold mt-3"><i class="bi bi-building"></i> Nationwide network</div>
                    </div>
                    <div class="bg-gradient-to-br from-blue-50 to-white rounded-2xl p-8 border border-blue-100 hover:shadow-lg transition-all relative overflow-hidden">
                        <div class="absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-blue-600 to-purple-600"></div>
                        <div class="text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-purple-600 mb-2">$${stats.totalRevenue.toLocaleString()}</div>
                        <div class="text-sm text-slate-600 font-medium uppercase tracking-wider mb-4">Platform Revenue</div>
                        <div class="text-sm text-slate-600">Total revenue generated</div>
                        <div class="flex items-center gap-2 text-green-600 text-xs font-semibold mt-3"><i class="bi bi-graph-up"></i> Strong growth</div>
                    </div>
                    <div class="bg-gradient-to-br from-blue-50 to-white rounded-2xl p-8 border border-blue-100 hover:shadow-lg transition-all relative overflow-hidden">
                        <div class="absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-blue-600 to-purple-600"></div>
                        <div class="text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-purple-600 mb-2">$${stats.averageRevenuePerClient.toFixed(0)}</div>
                        <div class="text-sm text-slate-600 font-medium uppercase tracking-wider mb-4">Avg Revenue/Client</div>
                        <div class="text-sm text-slate-600">Average spending per customer</div>
                        <div class="flex items-center gap-2 text-slate-600 text-xs font-semibold mt-3"><i class="bi bi-cash-stack"></i> Industry standard</div>
                    </div>
                    <div class="bg-gradient-to-br from-blue-50 to-white rounded-2xl p-8 border border-blue-100 hover:shadow-lg transition-all relative overflow-hidden">
                        <div class="absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-blue-600 to-purple-600"></div>
                        <div class="text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-purple-600 mb-2">99.9%</div>
                        <div class="text-sm text-slate-600 font-medium uppercase tracking-wider mb-4">Uptime</div>
                        <div class="text-sm text-slate-600">Platform reliability</div>
                        <div class="flex items-center gap-2 text-green-600 text-xs font-semibold mt-3"><i class="bi bi-shield-check"></i> Enterprise-grade</div>
                    </div>
                    <div class="bg-gradient-to-br from-blue-50 to-white rounded-2xl p-8 border border-blue-100 hover:shadow-lg transition-all relative overflow-hidden">
                        <div class="absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-blue-600 to-purple-600"></div>
                        <div class="text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-purple-600 mb-2">24/7</div>
                        <div class="text-sm text-slate-600 font-medium uppercase tracking-wider mb-4">Support</div>
                        <div class="text-sm text-slate-600">Always available assistance</div>
                        <div class="flex items-center gap-2 text-green-600 text-xs font-semibold mt-3"><i class="bi bi-headset"></i> Expert help</div>
                    </div>
                `;
            } catch (error) {
                console.error('Failed to load live stats:', error);
                loadingElement.style.display = 'none';
                statsGrid.innerHTML = '<div class="col-span-full text-center py-8 text-slate-600"><i class="bi bi-info-circle text-3xl mb-3"></i><p>Demo mode - Unable to load live statistics</p></div>';
            }
        }

        async function loadAboutStats() {
            try {
                const data = await client.query(`query { platformStats { totalClients totalCompanies } }`);
                const stats = data.platformStats;
                const totalServices = stats.totalClients * 12;
                const elements = {
                    'jobs-count': totalServices.toLocaleString() + '+',
                    'garages-count': stats.totalCompanies + '+',
                    'uptime-stat': '99.9%',
                    'growth-stat': '35%',
                    'about-workshops': stats.totalCompanies + '+',
                    'about-services': totalServices.toLocaleString() + '+',
                    'about-rating': '4.9/5',
                    'about-growth': '35%',
                    'about-uptime': '99.9%'
                };
                Object.entries(elements).forEach(([id, value]) => {
                    const el = document.getElementById(id);
                    if (el) el.textContent = value;
                });
            } catch (error) {
                console.error('Failed to load about stats:', error);
            }
        }

        async function loadFooterStats() {
            try {
                const response = await fetch('/graphql', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ query: 'query { platformStats { totalClients totalCompanies totalRevenue } }' })
                });
                const data = await response.json();
                if (data.data && data.data.platformStats) {
                    const stats = data.data.platformStats;
                    animateValue('footer-clients', 0, stats.totalClients, 2000);
                    animateValue('footer-garages', 0, stats.totalCompanies, 2000);
                    const revenueEl = document.getElementById('footer-revenue');
                    if (revenueEl) revenueEl.textContent = new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', minimumFractionDigits: 0 }).format(stats.totalRevenue);
                }
            } catch (error) {
                console.error('Error loading footer stats:', error);
            }
        }

        function animateValue(id, start, end, duration) {
            const element = document.getElementById(id);
            if (!element) return;
            const range = end - start;
            const increment = range / (duration / 16);
            let current = start;
            const timer = setInterval(() => {
                current += increment;
                if (current >= end) {
                    element.textContent = Math.round(end).toLocaleString();
                    clearInterval(timer);
                } else {
                    element.textContent = Math.round(current).toLocaleString();
                }
            }, 16);
        }

        const footerElement = document.querySelector('footer');
        if (footerElement) {
            const footerObserver = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        loadFooterStats();
                        footerObserver.unobserve(entry.target);
                    }
                });
            }, { threshold: 0.1 });
            footerObserver.observe(footerElement);
        }
    </script>
</body>
</html>
