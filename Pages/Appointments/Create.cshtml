@page
@model Gixat.Web.Pages.Appointments.CreateModel
@{
    Layout = "_AppLayout";
    ViewData["Title"] = "New Appointment";
}

<div class="max-w-5xl mx-auto animate-fade-in">
    <!-- Back Navigation -->
    <a href="/Appointments" class="inline-flex items-center gap-2 text-slate-600 hover:text-slate-900 mb-6 transition-colors group">
        <i class="bi bi-arrow-left group-hover:-translate-x-1 transition-transform"></i>
        <span class="text-sm font-medium">Back to Appointments</span>
    </a>

    <!-- Header -->
    <div class="mb-8">
        <div class="flex items-start justify-between">
            <div>
                <h1 class="text-3xl font-bold text-slate-900 tracking-tight">Schedule New Appointment</h1>
                <p class="text-slate-600 mt-2 flex items-center gap-2">
                    <i class="bi bi-calendar-check text-primary-600"></i>
                    <span>Book a service appointment for your customer</span>
                </p>
            </div>
            <div class="w-16 h-16 bg-gradient-to-br from-primary-600 to-blue-600 rounded-2xl flex items-center justify-center shadow-lg shadow-primary-500/30">
                <i class="bi bi-calendar-plus text-white text-2xl"></i>
            </div>
        </div>
    </div>

    @if (!string.IsNullOrEmpty(Model.ErrorMessage))
    {
        <div class="mb-6 bg-red-50 border-l-4 border-red-500 rounded-xl p-4 flex items-start gap-3">
            <i class="bi bi-exclamation-triangle-fill text-red-600 text-xl flex-shrink-0 mt-0.5"></i>
            <div class="flex-1">
                <h4 class="font-semibold text-red-900 mb-1">Error</h4>
                <p class="text-sm text-red-800">@Model.ErrorMessage</p>
            </div>
        </div>
    }

    <form method="post">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Main Form -->
            <div class="lg:col-span-2 space-y-6">
            <div>
                <label class="block text-sm font-medium text-gray-900 mb-2 flex items-center gap-2">
                    <i class="bi bi-person text-gray-500"></i>
                    Client <span class="text-red-500">*</span>
                </label>
                <select asp-for="Input.ClientId" class="apple-input" required>
                    <option value="">Select a client...</option>
                    @foreach (var client in Model.Clients)
                    {
                        <option value="@client.Id">@client.FirstName @client.LastName</option>
                    }
                </select>
                <span asp-validation-for="Input.ClientId" class="text-red-600 text-xs mt-1"></span>
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-900 mb-2 flex items-center gap-2">
                    <i class="bi bi-car-front text-gray-500"></i>
                    Vehicle (Optional)
                </label>
                <select asp-for="Input.ClientVehicleId" class="apple-input">
                    <option value="">No specific vehicle</option>
                    @foreach (var vehicle in Model.Vehicles)
                    {
                        <option value="@vehicle.Id" data-client="@vehicle.ClientId">
                            @vehicle.Make @vehicle.Model (@vehicle.LicensePlate)
                        </option>
                    }
                </select>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
            <div>
                <label class="block text-sm font-medium text-gray-900 mb-2 flex items-center gap-2">
                    <i class="bi bi-telephone text-gray-500"></i>
                    Contact Phone <span class="text-red-500">*</span>
                </label>
                <input asp-for="Input.ContactPhone" type="tel" class="apple-input" placeholder="+1234567890" required />
                <span asp-validation-for="Input.ContactPhone" class="text-red-600 text-xs mt-1"></span>
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-900 mb-2 flex items-center gap-2">
                    <i class="bi bi-envelope text-gray-500"></i>
                    Contact Email (Optional)
                </label>
                <input asp-for="Input.ContactEmail" type="email" class="apple-input" placeholder="client@example.com" />
            </div>
        </div>
    </div>

    <!-- Date & Time Selection -->
    <div class="apple-card">
        <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
            <i class="bi bi-calendar-event text-blue-600"></i>
            Schedule
        </h3>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div>
                <label class="block text-sm font-medium text-gray-900 mb-2 flex items-center gap-2">
                    <i class="bi bi-calendar3 text-gray-500"></i>
                    Date <span class="text-red-500">*</span>
                </label>
                <div class="relative">
                    <input asp-for="Input.ScheduledDate" type="date" class="apple-input" 
                           min="@DateTime.Today.ToString("yyyy-MM-dd")" required />
                </div>
                <span asp-validation-for="Input.ScheduledDate" class="text-red-600 text-xs mt-1"></span>
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-900 mb-2 flex items-center gap-2">
                    <i class="bi bi-clock text-gray-500"></i>
                    Time <span class="text-red-500">*</span>
                </label>
                <div class="relative">
                    <select asp-for="Input.ScheduledTime" class="apple-input" required>
                        <option value="">Select time...</option>
                        @for (int hour = 8; hour < 18; hour++)
                        {
                            for (int minute = 0; minute < 60; minute += 30)
                            {
                                var timeValue = $"{hour:D2}:{minute:D2}";
                                <option value="@timeValue">@timeValue</option>
                            }
                        }
                    </select>
                </div>
                <span asp-validation-for="Input.ScheduledTime" class="text-red-600 text-xs mt-1"></span>
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-900 mb-2 flex items-center gap-2">
                    <i class="bi bi-hourglass-split text-gray-500"></i>
                    Duration <span class="text-red-500">*</span>
                </label>
                <div class="relative">
                    <select asp-for="Input.DurationMinutes" class="apple-input" required>
                        <option value="30">30 minutes</option>
                        <option value="60" selected>1 hour</option>
                        <option value="90">1.5 hours</option>
                        <option value="120">2 hours</option>
                        <option value="180">3 hours</option>
                        <option value="240">4 hours</option>
                    </select>
                </div>
            </div>
        </div>
    </div>

    <!-- Service Details -->
    <div class="apple-card">
        <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
            <i class="bi bi-tools text-blue-600"></i>
            Service Details
        </h3>
        
        <div class="mb-4">
            <label class="block text-sm font-medium text-gray-900 mb-2 flex items-center gap-2">
                <i class="bi bi-wrench-adjustable text-gray-500"></i>
                Service Type <span class="text-red-500">*</span>
            </label>
            <div class="relative">
                <select asp-for="Input.ServiceType" class="apple-input" required>
                    <option value="">Select service type...</option>
                    <option value="Oil Change">üõ¢Ô∏è Oil Change</option>
                    <option value="Brake Service">üîß Brake Service</option>
                    <option value="Tire Service">üõû Tire Service</option>
                    <option value="Engine Diagnostic">‚öôÔ∏è Engine Diagnostic</option>
                    <option value="Transmission Service">üî© Transmission Service</option>
                    <option value="Electrical Repair">‚ö° Electrical Repair</option>
                    <option value="AC Service">‚ùÑÔ∏è AC Service</option>
                    <option value="General Inspection">üîç General Inspection</option>
                    <option value="Body Work">üî® Body Work</option>
                    <option value="Detailing">‚ú® Detailing</option>
                    <option value="Custom Work">üé® Custom Work</option>
                    <option value="Other">üìã Other</option>
                </select>
            </div>
            <span asp-validation-for="Input.ServiceType" class="text-red-600 text-xs mt-1"></span>
        </div>

        <div>
            <label class="block text-sm font-medium text-gray-900 mb-2 flex items-center gap-2">
                <i class="bi bi-chat-left-text text-gray-500"></i>
                Notes (Optional)
            </label>
            <div class="relative">
                <textarea asp-for="Input.Notes" rows="4" class="apple-input" 
                          placeholder="Any additional details or special requirements..."></textarea>
            </div>
        </div>
    </div>

    <!-- Submit Buttons -->
    <div class="flex items-center justify-end gap-3">
        <a href="/Appointments" class="apple-btn-secondary">
            Cancel
        </a>
        <button type="submit" class="apple-btn">
            <i class="bi bi-calendar-check"></i>
            Schedule Appointment
        </button>
    </div>
</form>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        // Filter vehicles based on selected client
        document.querySelector('[name="Input.ClientId"]').addEventListener('change', function(e) {
            const clientId = e.target.value;
            const vehicleSelect = document.querySelector('[name="Input.ClientVehicleId"]');
            const options = vehicleSelect.querySelectorAll('option');
            
            options.forEach(option => {
                if (option.value === '') {
                    option.style.display = 'block';
                } else {
                    const vehicleClientId = option.getAttribute('data-client');
                    option.style.display = vehicleClientId === clientId ? 'block' : 'none';
                }
            });
            
            vehicleSelect.value = '';
        });
    </script>
}
TEST-FILE-1765201169
