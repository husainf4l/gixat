@{
    Layout = "_Layout";
    var currentPath = Context.Request.Path.ToString().ToLower();
}

@RenderSection("Styles", required: false)

<!-- Top Navigation Bar -->
<nav class="sticky top-0 z-50 bg-white/80 backdrop-blur-apple border-b border-gray-200/60">
    <div class="px-4 lg:px-6">
        <div class="flex items-center justify-between h-14">
            <!-- Left: Logo & Mobile Menu -->
            <div class="flex items-center gap-3">
                <button id="mobile-menu-btn" class="lg:hidden p-2 -ml-2 text-apple-gray hover:text-apple-dark hover:bg-gray-100 rounded-apple transition-colors">
                    <i class="bi bi-list text-xl"></i>
                </button>
                <a href="/Dashboard" class="flex items-center gap-2.5 text-apple-dark font-semibold text-lg tracking-tight">
                    <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-apple-blue to-apple-indigo flex items-center justify-center">
                        <i class="bi bi-gear-wide-connected text-white text-sm"></i>
                    </div>
                    <span class="hidden sm:inline">Gixat</span>
                </a>
            </div>

            <!-- Center: Search (Desktop) -->
            <div class="hidden md:flex flex-1 max-w-md mx-8">
                <div class="relative w-full">
                    <i class="bi bi-search absolute left-3 top-1/2 -translate-y-1/2 text-apple-gray text-sm"></i>
                    <input type="text" placeholder="Search sessions, clients, vehicles..." 
                           class="w-full pl-9 pr-4 py-2 bg-gray-100 border-0 rounded-lg text-sm placeholder:text-apple-gray focus:outline-none focus:ring-2 focus:ring-apple-blue/30 focus:bg-white transition-all" />
                </div>
            </div>

            <!-- Right: Actions -->
            <div class="flex items-center gap-2">
                <!-- Notifications -->
                <button class="relative p-2 text-apple-gray hover:text-apple-dark hover:bg-gray-100 rounded-lg transition-colors">
                    <i class="bi bi-bell text-lg"></i>
                    <span class="absolute top-1.5 right-1.5 w-2 h-2 bg-apple-red rounded-full"></span>
                </button>
                
                <!-- User Menu -->
                <div class="flex items-center gap-2 pl-2 ml-2 border-l border-gray-200">
                    <div class="w-8 h-8 rounded-full bg-gradient-to-br from-apple-purple to-apple-pink flex items-center justify-center text-white text-xs font-medium">
                        @(User.Identity?.Name?.Substring(0, 2).ToUpper() ?? "U")
                    </div>
                    <span class="hidden sm:block text-sm font-medium text-apple-dark max-w-[120px] truncate">
                        @User.Identity?.Name
                    </span>
                    <a href="/Auth/Logout" class="p-2 text-apple-gray hover:text-apple-red hover:bg-apple-red/10 rounded-lg transition-colors" title="Logout">
                        <i class="bi bi-box-arrow-right"></i>
                    </a>
                </div>
            </div>
        </div>
    </div>
</nav>

<!-- Mobile Sidebar Overlay -->
<div id="mobile-backdrop" class="fixed inset-0 bg-black/30 backdrop-blur-sm z-40 opacity-0 pointer-events-none transition-opacity duration-300 lg:hidden"></div>

<!-- Mobile Sidebar -->
<aside id="mobile-sidebar" class="fixed inset-y-0 left-0 w-72 bg-white z-50 transform -translate-x-full transition-transform duration-300 ease-apple-spring lg:hidden shadow-apple-xl">
    <div class="flex items-center justify-between p-4 border-b border-gray-100">
        <span class="font-semibold text-apple-dark">Menu</span>
        <button id="close-mobile-menu" class="p-2 text-apple-gray hover:text-apple-dark hover:bg-gray-100 rounded-lg transition-colors">
            <i class="bi bi-x-lg"></i>
        </button>
    </div>
    
    <!-- Mobile Search -->
    <div class="p-4 border-b border-gray-100">
        <div class="relative">
            <i class="bi bi-search absolute left-3 top-1/2 -translate-y-1/2 text-apple-gray text-sm"></i>
            <input type="text" placeholder="Search..." class="w-full pl-9 pr-4 py-2.5 bg-gray-100 border-0 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-apple-blue/30" />
        </div>
    </div>
    
    <nav class="p-3 overflow-y-auto h-[calc(100%-130px)]">
        <p class="px-3 pb-2 text-xxs font-semibold text-apple-gray uppercase tracking-wider">Main Menu</p>
        <div class="space-y-0.5">
            <a href="/Dashboard" class="flex items-center gap-3 px-3 py-2.5 rounded-apple text-sm font-medium transition-all duration-200 @(currentPath == "/dashboard" ? "bg-apple-blue text-white" : "text-apple-dark hover:bg-gray-100")">
                <i class="bi bi-grid-1x2 text-base w-5 text-center"></i>
                Dashboard
            </a>
            <a href="/Sessions" class="flex items-center gap-3 px-3 py-2.5 rounded-apple text-sm font-medium transition-all duration-200 @(currentPath.StartsWith("/sessions") ? "bg-apple-blue text-white" : "text-apple-dark hover:bg-gray-100")">
                <i class="bi bi-clipboard-check text-base w-5 text-center"></i>
                Sessions
            </a>
            <a href="/Clients" class="flex items-center gap-3 px-3 py-2.5 rounded-apple text-sm font-medium transition-all duration-200 @(currentPath.StartsWith("/clients") ? "bg-apple-blue text-white" : "text-apple-dark hover:bg-gray-100")">
                <i class="bi bi-people text-base w-5 text-center"></i>
                Clients
            </a>
            <a href="/Vehicles" class="flex items-center gap-3 px-3 py-2.5 rounded-apple text-sm font-medium transition-all duration-200 @(currentPath.StartsWith("/vehicles") ? "bg-apple-blue text-white" : "text-apple-dark hover:bg-gray-100")">
                <i class="bi bi-car-front text-base w-5 text-center"></i>
                Vehicles
            </a>
            <a href="/Appointments" class="flex items-center gap-3 px-3 py-2.5 rounded-apple text-sm font-medium transition-all duration-200 @(currentPath.StartsWith("/appointments") ? "bg-apple-blue text-white" : "text-apple-dark hover:bg-gray-100")">
                <i class="bi bi-calendar-check text-base w-5 text-center"></i>
                Appointments
            </a>
            <a href="/JobCards" class="flex items-center gap-3 px-3 py-2.5 rounded-apple text-sm font-medium transition-all duration-200 @(currentPath.StartsWith("/jobcards") ? "bg-apple-blue text-white" : "text-apple-dark hover:bg-gray-100")">
                <i class="bi bi-clipboard-check text-base w-5 text-center"></i>
                Job Cards
            </a>
        </div>
        
        <p class="px-3 pt-6 pb-2 text-xxs font-semibold text-apple-gray uppercase tracking-wider">Business</p>
        <div class="space-y-0.5">
            <a href="/Invoices" class="flex items-center gap-3 px-3 py-2.5 rounded-apple text-sm font-medium transition-all duration-200 @(currentPath.StartsWith("/invoices") ? "bg-apple-blue text-white shadow-sm" : "text-apple-dark hover:bg-gray-100")">
                <i class="bi bi-receipt text-base w-5 text-center"></i>
                Invoices
            </a>
            <a href="/Inventory" class="flex items-center gap-3 px-3 py-2.5 rounded-apple text-sm font-medium transition-all duration-200 @(currentPath.StartsWith("/inventory") ? "bg-apple-blue text-white shadow-sm" : "text-apple-dark hover:bg-gray-100")">
                <i class="bi bi-box-seam text-base w-5 text-center"></i>
                Inventory
            </a>
            <a href="#" class="flex items-center gap-3 px-3 py-2.5 rounded-apple text-sm font-medium text-apple-dark hover:bg-gray-100 transition-all duration-200">
                <i class="bi bi-graph-up text-base w-5 text-center"></i>
                Reports
            </a>
        </div>
        
        <p class="px-3 pt-6 pb-2 text-xxs font-semibold text-apple-gray uppercase tracking-wider">Settings</p>
        <div class="space-y-0.5">
            <a href="/Settings/Users" class="flex items-center gap-3 px-3 py-2.5 rounded-apple text-sm font-medium transition-all duration-200 @(currentPath.StartsWith("/settings") ? "bg-apple-blue text-white shadow-sm" : "text-apple-dark hover:bg-gray-100")">
                <i class="bi bi-people text-base w-5 text-center"></i>
                User Management
            </a>
        </div>
    </nav>
</aside>

<div class="flex min-h-[calc(100vh-56px)]">
    <!-- Desktop Sidebar -->
    <aside class="hidden lg:flex lg:flex-col w-60 bg-white/50 backdrop-blur-sm border-r border-gray-200/60 fixed h-[calc(100vh-56px)] overflow-y-auto">
        <nav class="flex-1 p-3">
            <p class="px-3 pb-2 text-xxs font-semibold text-apple-gray uppercase tracking-wider">Main Menu</p>
            <div class="space-y-0.5">
                <a href="/Dashboard" class="flex items-center gap-3 px-3 py-2.5 rounded-apple text-sm font-medium transition-all duration-200 @(currentPath == "/dashboard" ? "bg-apple-blue text-white shadow-sm" : "text-apple-dark hover:bg-gray-100")">
                    <i class="bi bi-grid-1x2 text-base w-5 text-center"></i>
                    Dashboard
                </a>
                <a href="/Sessions" class="flex items-center gap-3 px-3 py-2.5 rounded-apple text-sm font-medium transition-all duration-200 @(currentPath.StartsWith("/sessions") ? "bg-apple-blue text-white shadow-sm" : "text-apple-dark hover:bg-gray-100")">
                    <i class="bi bi-clipboard-check text-base w-5 text-center"></i>
                    Sessions
                </a>
                <a href="/Clients" class="flex items-center gap-3 px-3 py-2.5 rounded-apple text-sm font-medium transition-all duration-200 @(currentPath.StartsWith("/clients") ? "bg-apple-blue text-white shadow-sm" : "text-apple-dark hover:bg-gray-100")">
                    <i class="bi bi-people text-base w-5 text-center"></i>
                    Clients
                </a>
                <a href="/Vehicles" class="flex items-center gap-3 px-3 py-2.5 rounded-apple text-sm font-medium transition-all duration-200 @(currentPath.StartsWith("/vehicles") ? "bg-apple-blue text-white shadow-sm" : "text-apple-dark hover:bg-gray-100")">
                    <i class="bi bi-car-front text-base w-5 text-center"></i>
                    Vehicles
                </a>
                <a href="/Appointments" class="flex items-center gap-3 px-3 py-2.5 rounded-apple text-sm font-medium transition-all duration-200 @(currentPath.StartsWith("/appointments") ? "bg-apple-blue text-white shadow-sm" : "text-apple-dark hover:bg-gray-100")">
                    <i class="bi bi-calendar-check text-base w-5 text-center"></i>
                    Appointments
                </a>
                <a href="/JobCards" class="flex items-center gap-3 px-3 py-2.5 rounded-apple text-sm font-medium transition-all duration-200 @(currentPath.StartsWith("/jobcards") ? "bg-apple-blue text-white shadow-sm" : "text-apple-dark hover:bg-gray-100")">
                    <i class="bi bi-clipboard-check text-base w-5 text-center"></i>
                    Job Cards
                </a>
            </div>
            
            <p class="px-3 pt-6 pb-2 text-xxs font-semibold text-apple-gray uppercase tracking-wider">Business</p>
            <div class="space-y-0.5">
                <a href="/Invoices" class="flex items-center gap-3 px-3 py-2.5 rounded-apple text-sm font-medium transition-all duration-200 @(currentPath.StartsWith("/invoices") ? "bg-apple-blue text-white shadow-sm" : "text-apple-dark hover:bg-gray-100")">
                    <i class="bi bi-receipt text-base w-5 text-center"></i>
                    Invoices
                </a>
                <a href="/Inventory" class="flex items-center gap-3 px-3 py-2.5 rounded-apple text-sm font-medium transition-all duration-200 @(currentPath.StartsWith("/inventory") ? "bg-apple-blue text-white shadow-sm" : "text-apple-dark hover:bg-gray-100")">
                    <i class="bi bi-box-seam text-base w-5 text-center"></i>
                    Inventory
                </a>
                <a href="#" class="flex items-center gap-3 px-3 py-2.5 rounded-apple text-sm font-medium text-apple-dark hover:bg-gray-100 transition-all duration-200">
                    <i class="bi bi-graph-up text-base w-5 text-center"></i>
                    Reports
                </a>
            </div>
            
            <p class="px-3 pt-6 pb-2 text-xxs font-semibold text-apple-gray uppercase tracking-wider">Settings</p>
            <div class="space-y-0.5">
                <a href="/Settings/Users" class="flex items-center gap-3 px-3 py-2.5 rounded-apple text-sm font-medium transition-all duration-200 @(currentPath.StartsWith("/settings") ? "bg-apple-blue text-white shadow-sm" : "text-apple-dark hover:bg-gray-100")">
                    <i class="bi bi-people text-base w-5 text-center"></i>
                    User Management
                </a>
            </div>
        </nav>
        
        <!-- Sidebar Footer -->
        <div class="p-4 border-t border-gray-100">
            <div class="p-3 bg-gradient-to-br from-gray-50 to-gray-100/80 rounded-apple">
                <p class="text-xs text-apple-gray mb-1">Need help?</p>
                <a href="#" class="text-sm font-medium text-apple-blue hover:text-apple-blue-hover transition-colors">
                    View Documentation â†’
                </a>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 lg:ml-60">
        <div class="p-4 lg:p-8 max-w-7xl mx-auto">
            @RenderBody()
        </div>
    </main>
</div>

@RenderSection("Scripts", required: false)

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const mobileSidebar = document.getElementById('mobile-sidebar');
        const mobileBackdrop = document.getElementById('mobile-backdrop');
        const closeMobileMenuBtn = document.getElementById('close-mobile-menu');

        function openMenu() {
            mobileSidebar.classList.remove('-translate-x-full');
            mobileBackdrop.classList.remove('opacity-0', 'pointer-events-none');
            document.body.style.overflow = 'hidden';
        }

        function closeMenu() {
            mobileSidebar.classList.add('-translate-x-full');
            mobileBackdrop.classList.add('opacity-0', 'pointer-events-none');
            document.body.style.overflow = '';
        }

        if (mobileMenuBtn) mobileMenuBtn.addEventListener('click', openMenu);
        if (mobileBackdrop) mobileBackdrop.addEventListener('click', closeMenu);
        if (closeMobileMenuBtn) closeMobileMenuBtn.addEventListener('click', closeMenu);
        
        // Close on escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeMenu();
        });
    });
</script>
